<div ng-include="'/components/common/heading.html'"></div>
<div class="wrapper wrapper-content">
    <div class="ibox animated fadeInUp" ng-show="thread">

        <div class="ibox-content">

            <div>
                <a href="" class="pull-left">
                    <img alt="image" src="assets/images/common/small-default-profile.jpg" ng-if="thread.owner.data.image.small === undefined" class="m-r-sm ng-cloak">
                    <img alt="image" ng-src="{{ thread.owner.data.image.small }}" ng-if="thread.owner.data.image.small !== undefined" class="m-r-sm ng-cloak">
                </a>

                <div class="media-body ">
                    <span class=" pull-right">
                        <button class="btn btn-white btn-xs" ng-if="thread.permissions.edit"> <i class="fa fa-pencil"></i> </button>
                        <button class="btn btn-white btn-xs" ng-if="thread.permissions.delete"> <i class="glyphicon glyphicon-remove"></i> </button>
                    </span>

                    <strong>{{ thread.owner.data.first_name }} {{ thread.owner.data.last_name }}</strong><br>
                    <small class="text-muted">{{ thread.created * 1000 | date : short }}</small>
                    <p>
                        {{ thread.body }}
                    </p>
                </div>
            </div>
            <div class="forum-post-info">
                <h4>
                    <span class="text-navy">
                        <i class="{{ thread.category.data.icon }}"></i> <a ui-sref="family.forum.category({category_slug: thread.category.data.slug})">{{ thread.category.data.name }}</a>
                    </span>
                    <span class="col-md-6 text-right pull-right" ng-if="thread.tags.data.length > 0">
                        <span ng-repeat="tag in thread.tags.data">
                            <button class="btn btn-white btn-xs">{{ tag.name }}</button>
                        </span>
                    </span>
                    <span class="small">
                        &nbsp;<i class="fa fa-clock-o"></i>
                        &nbsp;<span am-time-ago="thread.created" am-preprocess="unix"></span>
                    </span>
                </h4>
            </div>

        </div>
    </div>

    <div class="ibox">
        <div class="ibox-content">
            <form class="ng-pristine ng-valid" ng-if="thread.permissions.reply" name="threadReply"  ng-submit="addReply(comment)">
                <div class="form-group">
                    <textarea type="text" placeholder="Add reply" name="comment" ng-model="comment.body" class="form-control" rows="4" required="">
                    </textarea>
                </div>
                    <div class="form-group">
                        <button class="btn btn-primary form-control" ng-disabled="threadReply.$invalid">
                            Add Reply
                        </button>
                    </div>
                <br>
            </form>
            <div class="feed-activity-list">
                <div class="feed-element animated fadeInUp" ng-repeat="reply in thread.replies.data"  ng-class="{'flipOutX': reply.deleted}">
                    <a  ui-sref="family.members.profile({user: reply.owner.data.id})" class="pull-left">
                        <img alt="image" src="assets/images/common/small-default-profile.jpg" ng-if="reply.owner.data.image.small === undefined">
                        <img alt="image" ng-src="{{ reply.owner.data.image.small }}" ng-if="reply.owner.data.image.small !== undefined">
                    </a>

                    <div class="media-body text-muted">
                        <span class=" pull-right">
                            <button class="btn btn-white btn-xs" ng-if="reply.permissions.edit"> <i class="fa fa-pencil"></i> </button>
                            <button class="btn btn-white btn-xs" ng-if="reply.permissions.delete" ng-click="deleteReply(reply)"> <i class="glyphicon glyphicon-remove"></i> </button>
                        </span>

                        <strong>{{ reply.owner.data.first_name }} {{ reply.owner.data.last_name }}</strong><br>
                        <small class="text-muted">{{ reply.created * 1000 | date : short }}</small>
                        <p>
                            {{ reply.body }}
                        </p>
                    </div>
                </div>
            </div>
            <br>
            <p>
                <button type="button"
                        class="btn btn-block btn-outline btn-primary"
                        ng-click="more()"
                        ng-if="thread.replies.data.length < thread.replies.meta.pagination.total">
                    <i class="fa fa-arrow-down"></i> More replies
                </button>
            </p>
        </div>
    </div>
</div>